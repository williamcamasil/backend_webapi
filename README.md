# DocumentaçãoEsse projeto se trata da criação de apis nesse caso com CRUD onde eu utilizo WebApi com **C#** e **SQLServer**.## Requisitos- VisualStudio- SQLServer- Postman# SQLServerAcesse/Abra o **SQLServer Management**, crie um banco e execute as demais instruções.```create database smartphoneuse smartphonecreate table model (	spId int identity(1,1),	spNameModel varchar(500),	spNameBland varchar(500),	spPrice float)insert into model values ('Iphone XR', 'Apple', 2200.00)select * from model```> OBS: Se certifique que a tabela foi criada dentro do banco **smartphone**# Visual Studio> OBS: Ao instalar o VS é necessário instalar os itens> - ASP.NET and web development (ASP.NET e desenvolvimento Web)> - .NET desktop development (Desenvolvimento para desktop com .NET)> - .NET Core cross-platform development (Desenvolvimento multiplataforma com .NET Core)Acesse/Abra o **Visual Studio**, crie um novo projeto **ASP.NET Core Web Application** (Aplicativo Web ASP.NET Core)- Nomeio o projeto e selecione o local onde será salvo- Selecione API e desmarque HTTPSCrie o projeto. # Pastas e Arquivos do Projeto- **Dependências** (Dependencies) é o local onde iremos inserir nossas dependências.	- Dependências: Envolve o relacionamento entre atividades do projeto e atividades que não são do projeto. Ex: Atividades que são controladas em outros projetos. Você depende da conclusão de um projeto/ou entrega de um fornecedor para iniciar uma atividade do seu projeto.- **Properties / lauchSettings.json** é o local onde contém detalhes do que será iniciado e usado.- **Controllers (pasta)** é o local onde iremos inserir as classes com os métodos da API (GET/POST/PUT/DELETE)- **appsettings.json** é o local onde inserimos configurações do json- **Program.cs** é o local onde é iniciado o projeto- **Startup.cs** é o local onde é temos as configurações dos serviços/componentes do app# NuGet no VSInstale as seguintes libs:- Microsoft.AspNetCore.Mvc.NewtonsoftJson (v.3.1.9)- System.Data.SqlClient (v.4.8.2)# Codando## Startup.csNo arquivo **Startup.cs**, adicione dentro do método **ConfigureServices** o seguinte código:```//Enable CORSservices.AddCors(c =>{	c.AddPolicy("AllowOrigin", options => options.AllowAnyOrigin().AllowAnyMethod()	.AllowAnyHeader());});>//JSON Serializer	services.AddControllersWithViews()		.AddNewtonsoftJson(options =>		options.SerializerSettings.ReferenceLoopHandling = Newtonsoft		.Json.ReferenceLoopHandling.Ignore)```e dentro do método **Configure** insira:>app.UseCors(options => options.AllowAnyOrigin().AllowAnyMethod().AllowAnyHeader());# Conexão do SQLServer com Visual Studio Dentro do arquivo **appsettings.json** insira o seguinte código antes de "Logging"```"ConnectionStrings": {	"ConexãoBD": "Data Source=.;Initial Catalog=smartphone; Integrated Security=true"},```Explicação dos items:- **"ConexãoBD"** será o nome usado no método GetConnectionString no Controller- **Data Source=.;** é o acesso ao SQLServer	>Se atente a essa parte, pois em meu computador eu configurei o acesso através do '.' no caso de vocês podem ser outro nome. OBS: Esse nome se encontra quando abre o SQLServer ao acessar tem um campo chamado Server name e dele que é tirado / além disso a autenticação dele tem que ser Windows Authentication- **Catalog=smartphone;** nessa parte é inserido o nome do banco criado no SQLServer- **Integrated Security=true** liberação de acesso# Criando a pasta Models>Dentro dessa pasta conterá todos os arquivos e dentro dos arquivos suas propriedades, que foram criadas nas tabelas do SQL. >Por coincidência o nome da tabela criada no SQLServer é model de modelo, nesse caso do smartphone. Aqui poderia ser qualquer nome que tivesse haver com o nome da tabela.  Por exemplo, se eu tivesse criado uma tabela chamada Aparelhos, aqui eu poderia dar o nome de Aparelhos.cs para facilitar a localização e leitura.Crie uma **Classe** chamada Model.cs e insira o seguinte código:```using System;using System.Collections.Generic;using System.Linq;using System.Threading.Tasks;namespace WebAPI.Models{    public class Model    {        public int spId { get; set; }        public string spNameModel { get; set; }        public string spNameBland { get; set; }        public float spPrice { get; set; }    }}```# Criando o arquivo ModelControllers> O mesmo exemplo dado para os arquivos de dentro da Model pode ser usado aqui, nesse caso para o nome do Controller que nesse caso é ModelController.cs pois o nome da tabela é model.Crie um **Controller** chamado ModelController.cs e insira o seguinte código:```using Microsoft.AspNetCore.Http;using Microsoft.AspNetCore.Mvc;using Microsoft.Extensions.Configuration;using System;using System.Collections.Generic;using System.Data;using System.Data.SqlClient;using System.Linq;using System.Threading.Tasks;using WebAPI.Models;namespace WebAPI.Controllers{    [Route("api/[controller]")]    [ApiController]    public class ModelController : ControllerBase    {        private readonly IConfiguration _configuration;        public ModelController(IConfiguration configuration)        {            _configuration = configuration;        }        [HttpGet]        public JsonResult Get()        {            string query = @"                    select spId, spNameModel, spNameBland, spPrice from model";            DataTable table = new DataTable();            string sqlDataSource = _configuration.GetConnectionString("ConexionBD");            SqlDataReader myReader;            using (SqlConnection myCon = new SqlConnection(sqlDataSource))            {                myCon.Open();                using (SqlCommand myCommand = new SqlCommand(query, myCon))                {                    myReader = myCommand.ExecuteReader();                    table.Load(myReader); ;                    myReader.Close();                    myCon.Close();                }            }            return new JsonResult(table);        }        //GET values from only one item in the table        [HttpGet("{id}")]        public JsonResult Get(int id)        {            string query = @"                    select spId, spNameModel, spNameBland, spPrice from model where spId = " + id;            DataTable table = new DataTable();            string sqlDataSource = _configuration.GetConnectionString("ConexionBD");            SqlDataReader myReader;            using (SqlConnection myCon = new SqlConnection(sqlDataSource))            {                myCon.Open();                using (SqlCommand myCommand = new SqlCommand(query, myCon))                {                    myReader = myCommand.ExecuteReader();                    table.Load(myReader); ;                    myReader.Close();                    myCon.Close();                }            }            return new JsonResult(table);        }        //sp = SmartPhone        [HttpPost]        public JsonResult Post(Model sp)        {            string query = @"                    insert into model                     (spNameBland,spNameModel,spPrice)                    values                     (                        '" + sp.spNameBland + @"'                        ,'" + sp.spNameModel + @"'                        ,'" + sp.spPrice + @"'                    )";            DataTable table = new DataTable();            string sqlDataSource = _configuration.GetConnectionString("ConexionBD");            SqlDataReader myReader;            using (SqlConnection myCon = new SqlConnection(sqlDataSource))            {                myCon.Open();                using (SqlCommand myCommand = new SqlCommand(query, myCon))                {                    myReader = myCommand.ExecuteReader();                    table.Load(myReader); ;                    myReader.Close();                    myCon.Close();                }            }            return new JsonResult("Added Successfully");        }        [HttpPut]        public JsonResult Put(Model sp)        {            string query = @"                    update model set                     spNameModel = '" + sp.spNameModel + @"'                    ,spNameBland = '" + sp.spNameBland + @"'                    ,spPrice = '" + sp.spPrice + @"'                    where spId = " + sp.spId + @"                     ";            DataTable table = new DataTable();            string sqlDataSource = _configuration.GetConnectionString("ConexionBD");            SqlDataReader myReader;            using (SqlConnection myCon = new SqlConnection(sqlDataSource))            {                myCon.Open();                using (SqlCommand myCommand = new SqlCommand(query, myCon))                {                    myReader = myCommand.ExecuteReader();                    table.Load(myReader); ;                    myReader.Close();                    myCon.Close();                }            }            return new JsonResult("Updated Successfully");        }        [HttpDelete("{id}")]        public JsonResult Delete(int id)        {            string query = @"                    delete from model                    where spId = " + id + @"                     ";            DataTable table = new DataTable();            string sqlDataSource = _configuration.GetConnectionString("ConexionBD");            SqlDataReader myReader;            using (SqlConnection myCon = new SqlConnection(sqlDataSource))            {                myCon.Open();                using (SqlCommand myCommand = new SqlCommand(query, myCon))                {                    myReader = myCommand.ExecuteReader();                    table.Load(myReader); ;                    myReader.Close();                    myCon.Close();                }            }            return new JsonResult("Deleted Successfully");        }    }}```## Nesse código do Controller foi inserido:- IConfiguration - [HttpGet]- [HttpGet("{id}")]- [HttpPost]- [HttpPut]- [HttpDelete("{id}")]## Pontos importantes do código no ControllerEXEMPLO DO GET```		string query = @"                    select spId, spNameModel, spNameBland, spPrice from model";            DataTable table = new DataTable();            string sqlDataSource = _configuration.GetConnectionString("ConexionBD");            SqlDataReader myReader;            using (SqlConnection myCon = new SqlConnection(sqlDataSource))            {                myCon.Open();                using (SqlCommand myCommand = new SqlCommand(query, myCon))                {                    myReader = myCommand.ExecuteReader();                    table.Load(myReader); ;                    myReader.Close();                    myCon.Close();                }            }```- Note que temos a variável **query** com os campos iguais do SQLServer. - Note que temos dentro do método **GetConnectionString** o nome que inserimos no arquivo **appsettings.json** nesse caso o *ConexionBD*.# Teste no PostmanExecute o projeto (Selecione WebAPI)Caso esteja tudo certo, será aberto o cmd com o id local e junto a ele será aberto uma janela com api padrão.>http://localhost:5000/weatherforecastTroque para  >http://localhost:5000/api/modelSerá listado 1 item. No Postman crie os métodos- GET com a url > http://localhost:5000/api/model- GET com a url > http://localhost:5000/api/model/1- POST com a url > http://localhost:5000/api/model com **body**```{	"spNameModel":  "XTI802",	"spNameBland":  "Motorola",	"spPrice":  1400.00}```- PUT com a url > http://localhost:5000/api/model com **body**```{	"spId":  2,	"spNameModel":  "XTI802",	"spNameBland":  "Motorola",	"spPrice":  1500.00}```- DELETE com a url > http://localhost:5000/api/model/2Realizado todos os testes teremos o CRUD criado com sucesso!Espero ter ajudado! :)